module prerelease

amends "package://pkg.pkl-lang.org/github.com/stefma/pkl-gha/com.github.action@0.0.4#/GitHubAction.pkl"

import "helpers/Common.pkl"
import "helpers/Steps.pkl"

name = "Publish Prerelease"
on {
  workflow_dispatch{}
}
env = Common.defaultEnv
jobs {
  ["main"] {
    `runs-on` = new UbuntuLatest{}
    name = "Publish package to S3"
    steps {
      Steps.checkoutWithoutMatchers(false)
      Steps.downloadAllArtifacts()
      Steps.readVersionFromPackage()
      ...Steps.uploadPackagesToSleet(Steps.getVersionExpresssion, false)
      ...Steps.uploadToNPM("alpha")
    }
  }
}
